# ContributionsToOpenSource

## Qi Zhu is a very active contributor to HADOOP(YARN/HDFS)
Mark the contribution to open source.

## Merged to Apache Community

### Hadoop (HDFS/YARN)

[YARN-10503](https://issues.apache.org/jira/browse/YARN-10503). Support queue capacity in terms of absolute resources with custom resourceType. Contributed by Qi Zhu.

[YARN-10720](https://issues.apache.org/jira/browse/YARN-10720) YARN WebAppProxyServlet should support connection timeout to prevent proxy server from hanging. Contributed by Qi Zhu.

[YARN-9618](https://issues.apache.org/jira/browse/YARN-9618) NodesListManager event improvement. Contributed by Qi Zhu.

[YARN-10532](https://issues.apache.org/jira/browse/YARN-10532) Capacity Scheduler Auto Queue Creation: Allow auto delete queue when queue is not being used. Contributed by Qi Zhu.  

[YARN-10674](https://issues.apache.org/jira/browse/YARN-10674) fs2cs should generate auto-created queue deletion properties. Contributed by Qi Zhu.

[YARN-10623](https://issues.apache.org/jira/browse/YARN-10623) Capacity scheduler should support refresh queue automatically by a thread policy. Contributed by Qi Zhu.   

[YARN-10726](https://issues.apache.org/jira/browse/YARN-10726) Log the size of DelegationTokenRenewer event queue in case of too many pending events. Contributed by Qi Zhu.

[YARN-10687](https://issues.apache.org/jira/browse/YARN-10687) Add option to disable/enable free disk space checking and percentage checking for full and not-full disks. Contributed by Qi Zhu.

[YARN-10739](https://issues.apache.org/jira/browse/YARN-10739) GenericEventHandler.printEventQueueDetails causes RM recovery to take too much time. Contributed by Qi Zhu.

[YARN-10624](https://issues.apache.org/jira/browse/YARN-10624)Support max queues limit configuration in new auto created queue, consistent with old auto created. Contributed by Qi Zhu

[YARN-9615](https://issues.apache.org/jira/browse/YARN-9615) Add dispatcher metrics to RM. Contributed by Jonathan Hung and Qi Zhu.

[YARN-10707](https://issues.apache.org/jira/browse/YARN-10707) Support custom resources in ResourceUtilization, and update Node GPU Utilization to use. Contributed by Qi Zhu

[YARN-10688](https://issues.apache.org/jira/browse/YARN-10688) ClusterMetrics should support GPU capacity related metrics.. Contributed by Qi Zhu.

[YARN-10713](https://issues.apache.org/jira/browse/YARN-10713) ClusterMetrics should support custom resource capacity related metrics. Contributed by Qi Zhu.

[YARN-10610](https://issues.apache.org/jira/browse/YARN-10610) Add queuePath to RESTful API for CapacityScheduler consistent with FairScheduler queuePath. Contributed by Qi Zhu

[YARN-10658](https://issues.apache.org/jira/browse/YARN-10658) CapacityScheduler QueueInfo add queue path field to avoid ambiguous QueueName. Contributed by Qi Zhu.

[YARN-10641](https://issues.apache.org/jira/browse/YARN-10641) Refactor the max app related update, and fix maxApllications update error when add new queues. Contributed by Qi Zhu.

[YARN-10692](https://issues.apache.org/jira/browse/YARN-10692) Add Node GPU Utilization and apply to NodeMetrics. Contributed by Qi Zhu.

[YARN-10639](https://issues.apache.org/jira/browse/YARN-10639) Queueinfo related capacity, should adjusted to weight mode. Contributed by Qi Zhu.

[YARN-10640](https://issues.apache.org/jira/browse/YARN-10640) Adjust the queue Configured capacity to Configured weight number for weight mode in UI. Contributed by Qi Zhu.

[YARN-10587](https://issues.apache.org/jira/browse/YARN-10587) Fix AutoCreateLeafQueueCreation cap related caculation when in absolute mode. (Qi Zhu via wangda)

[YARN-10531](https://issues.apache.org/jira/browse/YARN-10531) Be able to disable user limit factor for CapacityScheduler Leaf Queue. (Qi Zhu via wangda)

[YARN-10506](https://issues.apache.org/jira/browse/YARN-10506) Update queue creation logic to use weight mode and allow the flexible static/dynamic creation. (Contributed by Qi Zhu, Andras Gyori)

[YARN-10463](https://issues.apache.org/jira/browse/YARN-10463) For Federation, we should support getApplicationAttemptReport. (#2563) Qi Zhu via Zhankun Tang

[YARN-10685](https://issues.apache.org/jira/browse/YARN-10685) Fix typos in AbstractCSQueue. Contributed by Qi Zhu.

[YARN-10637](https://issues.apache.org/jira/browse/YARN-10637) fs2cs: add queue autorefresh policy during conversion. Contributed by Qi Zhu.

[YARN-10504](https://issues.apache.org/jira/browse/YARN-10504) Implement weight mode in Capacity Scheduler. (Contributed by Wangda Tan, Benjamin Teke, zhuqi, Andras Gyori)

[YARN-10380](https://issues.apache.org/jira/browse/YARN-10380) Import logic of multi-node allocation in CapacityScheduler (#2494)  Contributed by Qi Zhu.

[YARN-10470](https://issues.apache.org/jira/browse/YARN-10470) When building new web ui with root user, the bower install should support it. Contributed by zhuqi.

[YARN-10352](https://issues.apache.org/jira/browse/YARN-10352) Skip schedule on not heartbeated nodes in Multi Node Placement. Contributed by Prabhu Joseph and Qi Zhu

[YARN-10718](https://issues.apache.org/jira/browse/YARN-10718) Fix CapacityScheduler#initScheduler log error. Contributed by Qi Zhu.

[YARN-10723](https://issues.apache.org/jira/browse/YARN-10723) Change CS nodes page in UI to support custom resource. Contributed by Qi Zhu

[YARN-10448](https://issues.apache.org/jira/browse/YARN-10448) SLS should set default user to handle SYNTH format. Contributed by zhuqi
[YARN-10743](https://issues.apache.org/jira/browse/YARN-10743) Add a policy for not aggregating for containers which are killed because exceeding container log size limit. Contributed by Qi Zhu

[YARN-10611](https://issues.apache.org/jira/browse/YARN-10611) Fix that shaded should be used for google guava imports in YARN-10352. Contributed by Qi Zhu

[YARN-10647](https://issues.apache.org/jira/browse/YARN-10647) Fix TestRMNodeLabelsManager failed after YARN-10501. Contributed by Qi Zhu.

[YARN-10609](https://issues.apache.org/jira/browse/YARN-10609) Update the document for YARN-10531(Be able to disable user limit factor for CapacityScheduler Leaf Queue). Contributed by Qi Zhu.

[YARN-8995](https://issues.apache.org/jira/browse/YARN-8995) Log events info in AsyncDispatcher when event queue size cumulatively reaches a certain number every time. Contributed by zhuqi.

[YARN-10686](https://issues.apache.org/jira/browse/YARN-10686) Fix TestCapacitySchedulerAutoQueueCreation#testAutoQueueCreationFailsForEmptyPathWithAQCAndWeightMode. Contributed by Qi Zhu.

[YARN-10497](https://issues.apache.org/jira/browse/YARN-10497) Fix an issue in CapacityScheduler which fails to delete queues. Contributed by Wangda Tan and Qi Zhu.
 
[YARN-10682](https://issues.apache.org/jira/browse/YARN-10682) The scheduler monitor policies conf should trim values separated by comma. Contributed by Qi Zhu.

[YARN-10653](https://issues.apache.org/jira/browse/YARN-10653) Fixed the findbugs issues introduced by YARN-10647. Contributed by Qi Zhu

[YARN-10689](https://issues.apache.org/jira/browse/YARN-10689) Fix the finding bugs in extractFloatValueFromWeightConfig. (#2760)

[YARN-10703](https://issues.apache.org/jira/browse/YARN-10703) Fix potential null pointer error of gpuNodeResourceUpdateHandler in NodeResourceMonitorImpl. Contributed by Qi Zhu.

[YARN-10701](https://issues.apache.org/jira/browse/YARN-10701) The yarn.resource-types should support multi types without trimmed. Contributed by Qi Zhu.
[HDFS-15934](https://issues.apache.org/jira/browse/HDFS-15934) Make DirectoryScanner reconcile blocks batch size and interval between batch configurable. Contributed by Qi Zhu. (#2833)

[HDFS-15856](https://issues.apache.org/jira/browse/HDFS-15856) Make write pipeline retry times configurable. (#2721). Contributed by Qi Zhu

[HDFS-15041](https://issues.apache.org/jira/browse/HDFS-15041) Make MAX_LOCK_HOLD_MS and full queue size configurable. Contributed by zhuqi.

[HDFS-15856](https://issues.apache.org/jira/browse/HDFS-15856) Make write pipeline retry times configurable. (#2721). Contributed by Qi Zhu

[HDFS-15930](https://issues.apache.org/jira/browse/HDFS-15930) Fix some @param errors in DirectoryScanner. (#2829). Contributed by Qi Zhu.

[HADOOP-17619](https://issues.apache.org/jira/browse/HADOOP-17619) Fix DelegationTokenRenewer#updateRenewalTime java doc error. (#2846). Contributed by Qi Zhu.

### BigTop
[BIGTOP-3456](https://issues.apache.org/jira/browse/BIGTOP-3456) Add hadoop-yarn-router and hadoop-hdfs-dfsrouter to hadoop services (#703)

## Patch availale or In progress:
### YARN/HDFS

[YARN-10178](https://issues.apache.org/jira/browse/YARN-10178) Global Scheduler async thread crash caused by 'Comparison method violates its general contract'

[YARN-10632](https://issues.apache.org/jira/browse/YARN-10632) Make maximum depth allowed configurable.

[YARN-10221](https://issues.apache.org/jira/browse/YARN-10221) Nodemanager lockups on printEventQueueDetails

[YARN-10641](https://issues.apache.org/jira/browse/YARN-10641) Refactor the max app related update, and fix maxApllications update error when add new queues.

[YARN-10657](https://issues.apache.org/jira/browse/YARN-10657) We should make max application per queue to support node label.

[YARN-10650](https://issues.apache.org/jira/browse/YARN-10650) Create dispatcher metrics interface, and apply to RM async dispatcher.

[YARN-10645](https://issues.apache.org/jira/browse/YARN-10645) Fix queue state related update for auto created queue.

[YARN-10638](https://issues.apache.org/jira/browse/YARN-10638) Add fair call queue support to event processing queue.

[YARN-9927](https://issues.apache.org/jira/browse/YARN-9927) RM multi-thread event processing mechanism

[YARN-10546](https://issues.apache.org/jira/browse/YARN-10546) Limit application resource reservation on nodes for non-node/rack specific requests shoud be supported in CS.

[YARN-10608](https://issues.apache.org/jira/browse/YARN-10608) Extend yarn.nodemanager.delete.debug-delay-sec to support application level.

[YARN-10590](https://issues.apache.org/jira/browse/YARN-10590) Fix TestCapacitySchedulerAutoCreatedQueueBase witch related absolute caculation loss.

[YARN-10592](https://issues.apache.org/jira/browse/YARN-10592) Support QueueCapacities to use vector based multi resource types, and update absolute related to use first.

[YARN-10524](https://issues.apache.org/jira/browse/YARN-10524) Support multi resource type based weight mode in CS.

[YARN-10514](https://issues.apache.org/jira/browse/YARN-10514) Introduce a dominant resource based schedule policy to increase the resource utilization, avoid heavy cluster resource fragments.

[YARN-10169](https://issues.apache.org/jira/browse/YARN-10169) Mixed absolute resource value and percentage-based resource value in CapacityScheduler should fail

[YARN-8556](https://issues.apache.org/jira/browse/YARN-8556) Support dynamic policy updates in Capacity Scheduler

[YARN-6224](https://issues.apache.org/jira/browse/YARN-6224) Should consider utilization of each ResourceType on node while scheduling
 
[YARN-10111](https://issues.apache.org/jira/browse/YARN-10111) In Federation cluster Distributed Shell Application submission fails as YarnClient#getQueueInfo is not implemented

[YARN-10132](https://issues.apache.org/jira/browse/YARN-10132) For Federation,yarn applicationattempt fail command throws an exception

[YARN-9634](https://issues.apache.org/jira/browse/YARN-9634) Make yarn submit dir and log aggregation dir more evenly distributed

[YARN-9212](https://issues.apache.org/jira/browse/YARN-9212) Add the acquired containers metrics to get the cluster throughput.

[HDFS-15874](https://issues.apache.org/jira/browse/HDFS-15874) Extend TopMetrics to support callerContext aggregation.

[HDFS-15584](https://issues.apache.org/jira/browse/HDFS-15584) Improve HDFS large deletion cause namenode lockqueue boom and pending deletion boom.

[HDFS-15180](https://issues.apache.org/jira/browse/HDFS-15180) DataNode FsDatasetImpl Fine-Grained Locking via BlockPool.

[HDFS-15177](https://issues.apache.org/jira/browse/HDFS-15177) Split datanode invalide block deletion, to avoid the FsDatasetImpl lock too much time.

[HDFS-15171](https://issues.apache.org/jira/browse/HDFS-15171) Add a thread to call saveDfsUsed periodically, to prevent datanode too long restart time.
 
[HDFS-15109](https://issues.apache.org/jira/browse/HDFS-15109) RBF: Plugin interface to enable delegation of Router

[HDFS-15083](https://issues.apache.org/jira/browse/HDFS-15083) Add new trash rpc which move the trash (mkdir and the rename) operation to the server side.

[HDFS-14944](https://issues.apache.org/jira/browse/HDFS-14944)  ec admin such as : -enablePolicy should support multi federation namespace not only the default namespace in core-site.xml



### Hadoop Common:
[HADOOP-17257](https://issues.apache.org/jira/browse/HADOOP-17257) pid file delete when service stop (secure datanode ) show cat no directory

### Ozone:
[HDDS-4561](https://issues.apache.org/jira/browse/HDDS-4561) We should support suggested Ratis Server Leader in OM HA.

### Flink:
[FLINK-16809](https://issues.apache.org/jira/browse/FLINK-16809) Support setting CallerContext on YARN deployments


